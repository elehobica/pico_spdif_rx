#------------------------------------------------------
# Copyright (c) 2025, Elehobica
# Released under the BSD-2-Clause
# refer to https://opensource.org/licenses/BSD-2-Clause
#------------------------------------------------------

name: Build

on: [push, pull_request]

jobs:
  build-detect-samp-freq:
    runs-on: ubuntu-latest
    env:
      RELEASE_DIR: Release
    outputs:
      release-tag-condition-matched: ${{ steps.release-tag-condition.outputs.matched }}
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      - name: Build Pico
        uses: ./.github/actions/build-and-rename
        with:
          path: samples/detect_samp_freq
          build: build
          identifier: pico
          output_path: ${{ env.RELEASE_DIR }}
      - name: Build Pico 2
        uses: ./.github/actions/build-and-rename
        with:
          path: samples/detect_samp_freq
          build: build2
          platform: rp2350
          board: pico2
          identifier: pico2
          output_path: ${{ env.RELEASE_DIR }}
      - name: Upload production artifacts
        uses: actions/upload-artifact@v4
        with:
          name: dist-binaries0
          path: |
            ${{ env.RELEASE_DIR }}/*.uf2
            ${{ env.RELEASE_DIR }}/*.elf

  build-spdif-to-i2s-32b:
    runs-on: ubuntu-latest
    env:
      RELEASE_DIR: Release
    outputs:
      release-tag-condition-matched: ${{ steps.release-tag-condition.outputs.matched }}
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      - name: Build Pico
        uses: ./.github/actions/build-and-rename
        with:
          path: samples/spdif_to_i2s_32b
          build: build
          identifier: pico
          output_path: ${{ env.RELEASE_DIR }}
      - name: Build Pico 2
        uses: ./.github/actions/build-and-rename
        with:
          path: samples/spdif_to_i2s_32b
          build: build2
          platform: rp2350
          board: pico2
          identifier: pico2
          output_path: ${{ env.RELEASE_DIR }}
      - name: Upload production artifacts
        uses: actions/upload-artifact@v4
        with:
          name: dist-binaries1
          path: |
            ${{ env.RELEASE_DIR }}/*.uf2
            ${{ env.RELEASE_DIR }}/*.elf
